<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minecraft Character Simulator</title>
    <style>
      /* ===== FONT INTEGRATION ===== */
      @font-face {
        font-family: "Minecrafter";
        src: url("fonts/minecrafter/subset-Minecrafter.woff2") format("woff2"),
          url("fonts/minecrafter/subset-Minecrafter.woff") format("woff"),
          url("fonts/minecrafter/subset-Minecrafter.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }

      /* ===== RESET & BASE STYLES ===== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Minecrafter", "Courier New", monospace;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
      }

      /* ===== CSS VARIABLES ===== */
      :root {
        --char-unit: calc(10vh / 12);
        --sky-color-top: #87ceeb;
        --sky-color-bottom: #4a90e2;
        --grass-color: #7ec850;
        --dirt-color: #8b4513;
      }

      /* ===== WORLD CONTAINER ===== */
      #world {
        position: fixed;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
      }

      /* ===== BACKGROUND LAYERS ===== */
      .sky-layer {
        position: absolute;
        width: 100%;
        height: 50%;
        background: linear-gradient(
          to bottom,
          var(--sky-color-top),
          var(--sky-color-bottom)
        );
        top: 0;
      }

      .grass-layer {
        position: absolute;
        width: 100%;
        height: 30%;
        background: var(--grass-color);
        top: 50%;
        overflow: hidden;
      }

      .grass-layer::before {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(
            0deg,
            transparent 24%,
            rgba(106, 168, 79, 0.3) 25%,
            rgba(106, 168, 79, 0.3) 26%,
            transparent 27%,
            transparent 74%,
            rgba(106, 168, 79, 0.3) 75%,
            rgba(106, 168, 79, 0.3) 76%,
            transparent 77%,
            transparent
          ),
          linear-gradient(
            90deg,
            transparent 24%,
            rgba(106, 168, 79, 0.3) 25%,
            rgba(106, 168, 79, 0.3) 26%,
            transparent 27%,
            transparent 74%,
            rgba(106, 168, 79, 0.3) 75%,
            rgba(106, 168, 79, 0.3) 76%,
            transparent 77%,
            transparent
          );
        background-size: 50px 50px;
      }

      .dirt-layer {
        position: absolute;
        width: 100%;
        height: 20%;
        background: var(--dirt-color);
        top: 80%;
        overflow: hidden;
      }

      .dirt-layer::before {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(
            circle at 20% 20%,
            rgba(0, 0, 0, 0.2) 2px,
            transparent 2px
          ),
          radial-gradient(
            circle at 60% 40%,
            rgba(0, 0, 0, 0.2) 2px,
            transparent 2px
          ),
          radial-gradient(
            circle at 40% 70%,
            rgba(0, 0, 0, 0.2) 2px,
            transparent 2px
          ),
          radial-gradient(
            circle at 80% 60%,
            rgba(0, 0, 0, 0.2) 2px,
            transparent 2px
          ),
          radial-gradient(
            circle at 15% 85%,
            rgba(0, 0, 0, 0.2) 2px,
            transparent 2px
          );
        background-size: 40px 40px;
      }

      /* ===== CHARACTERS CONTAINER ===== */
      #characters-container {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
      }

      /* ===== CHARACTER BASE STYLES ===== */
      .character {
        position: absolute;
        width: calc(var(--char-unit) * 4);
        height: calc(var(--char-unit) * 12);
        bottom: calc(20vh);
        will-change: transform;
        transition: none;
      }

      /* ===== CHARACTER PARTS ===== */
      .char-head {
        width: calc(var(--char-unit) * 3);
        height: calc(var(--char-unit) * 3);
        position: absolute;
        top: 0;
        left: calc(var(--char-unit) * 0.5);
        border: 2px solid #000;
        box-shadow: inset -2px -2px 4px rgba(0, 0, 0, 0.3),
          2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .char-body {
        width: calc(var(--char-unit) * 4);
        height: calc(var(--char-unit) * 6);
        position: absolute;
        top: calc(var(--char-unit) * 3);
        border: 2px solid #000;
        box-shadow: inset -2px -2px 4px rgba(0, 0, 0, 0.3),
          2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .char-arm {
        width: calc(var(--char-unit) * 1);
        height: calc(var(--char-unit) * 5);
        position: absolute;
        top: calc(var(--char-unit) * 3);
        border: 2px solid #000;
        transform-origin: top center;
        box-shadow: inset -1px -1px 2px rgba(0, 0, 0, 0.3),
          1px 1px 2px rgba(0, 0, 0, 0.2);
      }

      .char-arm.left {
        left: calc(var(--char-unit) * -1);
      }

      .char-arm.right {
        right: calc(var(--char-unit) * -1);
      }

      .char-leg {
        width: calc(var(--char-unit) * 1.5);
        height: calc(var(--char-unit) * 5);
        position: absolute;
        top: calc(var(--char-unit) * 9);
        border: 2px solid #000;
        transform-origin: top center;
        box-shadow: inset -1px -1px 2px rgba(0, 0, 0, 0.3),
          1px 1px 2px rgba(0, 0, 0, 0.2);
      }

      .char-leg.left {
        left: calc(var(--char-unit) * 0.5);
      }

      .char-leg.right {
        right: calc(var(--char-unit) * 0.5);
      }

      /* ===== NAME LABELS ===== */
      .name-label {
        position: absolute;
        top: calc(var(--char-unit) * -6);
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 20px;
        white-space: nowrap;
        pointer-events: none;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      }

      /* ===== WALKING ANIMATIONS ===== */
      @keyframes walk-left-arm {
        0%,
        100% {
          transform: rotate(-25deg);
        }
        50% {
          transform: rotate(25deg);
        }
      }

      @keyframes walk-right-arm {
        0%,
        100% {
          transform: rotate(25deg);
        }
        50% {
          transform: rotate(-25deg);
        }
      }

      @keyframes walk-left-leg {
        0%,
        100% {
          transform: rotate(25deg);
        }
        50% {
          transform: rotate(-25deg);
        }
      }

      @keyframes walk-right-leg {
        0%,
        100% {
          transform: rotate(-25deg);
        }
        50% {
          transform: rotate(25deg);
        }
      }

      .character.walking .char-arm.left {
        animation: walk-left-arm 0.6s infinite ease-in-out;
      }

      .character.walking .char-arm.right {
        animation: walk-right-arm 0.6s infinite ease-in-out;
      }

      .character.walking .char-leg.left {
        animation: walk-left-leg 0.6s infinite ease-in-out;
      }

      .character.walking .char-leg.right {
        animation: walk-right-leg 0.6s infinite ease-in-out;
      }

      /* ===== CONTROL PANEL ===== */
      #control-panel {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.85);
        border: 3px solid #444;
        border-radius: 8px;
        padding: 20px;
        min-width: 280px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      #control-panel h2 {
        color: #ffd700;
        font-size: 18px;
        margin-bottom: 15px;
        text-align: center;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      }

      #spawn-form {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      #spawn-form label {
        display: flex;
        flex-direction: column;
        color: #fff;
        font-size: 12px;
        gap: 4px;
      }

      #spawn-form input[type="text"] {
        padding: 8px;
        border: 2px solid #444;
        background: #222;
        color: #fff;
        font-family: "Minecrafter", "Courier New", monospace;
        font-size: 12px;
        border-radius: 4px;
      }

      #spawn-form input[type="color"] {
        height: 40px;
        width: 100%;
        border: 2px solid #444;
        background: #222;
        cursor: pointer;
        border-radius: 4px;
      }

      #spawn-form button {
        padding: 12px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        font-family: "Minecrafter", "Courier New", monospace;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.3s;
        margin-top: 8px;
      }

      #spawn-form button:hover:not(:disabled) {
        background: #45a049;
      }

      #spawn-form button:disabled {
        background: #666;
        cursor: not-allowed;
      }

      .counter {
        text-align: center;
        color: #ffd700;
        font-size: 14px;
        margin-top: 8px;
      }

      /* ===== RESPONSIVE ADJUSTMENTS ===== */
      @media (max-width: 768px) {
        #control-panel {
          top: 10px;
          right: 10px;
          min-width: 240px;
          padding: 15px;
        }

        #control-panel h2 {
          font-size: 14px;
        }

        #spawn-form label {
          font-size: 10px;
        }
      }
    </style>
  </head>
  <body>
    <!-- World Container -->
    <div id="world">
      <!-- Background Layers -->
      <div class="sky-layer"></div>
      <div class="grass-layer"></div>
      <div class="dirt-layer"></div>

      <!-- Characters Container -->
      <div id="characters-container"></div>
    </div>

    <!-- Control Panel -->
    <div id="control-panel">
      <h2>Spawn Character</h2>
      <form id="spawn-form">
        <label>
          Name:
          <input
            type="text"
            id="char-name"
            placeholder="Enter name"
            required
            maxlength="20"
          />
        </label>
        <label>
          Skin Tone:
          <input type="color" id="skin-color" value="#FFD9A0" />
        </label>
        <label>
          T-Shirt Color:
          <input type="color" id="shirt-color" value="#3498db" />
        </label>
        <label>
          Pants Color:
          <input type="color" id="pants-color" value="#2c3e50" />
        </label>
        <button type="submit">Add Character</button>
        <p class="counter"><span id="char-count">0</span>/15</p>
      </form>
    </div>

    <script>
      // ===== CHARACTER CLASS =====
      class MinecraftCharacter {
        constructor(name, colors, id) {
          this.id = id;
          this.name = name;
          this.colors = colors;
          this.position = {
            x: Math.random() * (window.innerWidth - 100),
            y: 0,
          };
          this.velocity = {
            x: (Math.random() - 0.5) * 100,
            y: 0,
          };
          this.direction = this.velocity.x > 0 ? "right" : "left";
          this.isJumping = false;
          this.jumpProgress = 0;
          this.directionTimer = this.randomInterval(2000, 4000);
          this.jumpTimer = this.randomInterval(3000, 7000);
          this.element = null;
        }

        randomInterval(min, max) {
          return min + Math.random() * (max - min);
        }

        spawn(container) {
          // Create character element
          this.element = document.createElement("div");
          this.element.className = "character walking";
          this.element.dataset.id = this.id;

          // Create name label
          const nameLabel = document.createElement("div");
          nameLabel.className = "name-label";
          nameLabel.textContent = this.name;

          // Create character parts
          const head = document.createElement("div");
          head.className = "char-head";
          head.style.backgroundColor = this.colors.skin;

          const body = document.createElement("div");
          body.className = "char-body";
          body.style.backgroundColor = this.colors.shirt;

          const armLeft = document.createElement("div");
          armLeft.className = "char-arm left";
          armLeft.style.backgroundColor = this.colors.skin;

          const armRight = document.createElement("div");
          armRight.className = "char-arm right";
          armRight.style.backgroundColor = this.colors.skin;

          const legLeft = document.createElement("div");
          legLeft.className = "char-leg left";
          legLeft.style.backgroundColor = this.colors.pants;

          const legRight = document.createElement("div");
          legRight.className = "char-leg right";
          legRight.style.backgroundColor = this.colors.pants;

          // Assemble character
          this.element.appendChild(nameLabel);
          this.element.appendChild(head);
          this.element.appendChild(body);
          this.element.appendChild(armLeft);
          this.element.appendChild(armRight);
          this.element.appendChild(legLeft);
          this.element.appendChild(legRight);

          // Add to container
          container.appendChild(this.element);

          // Initial render
          this.render();
        }

        update(deltaTime) {
          // Update direction timer
          this.directionTimer -= deltaTime * 1000;
          if (this.directionTimer <= 0) {
            this.velocity.x = (Math.random() - 0.5) * 100;
            this.direction = this.velocity.x > 0 ? "right" : "left";
            this.directionTimer = this.randomInterval(2000, 4000);
          }

          // Update jump timer
          this.jumpTimer -= deltaTime * 1000;
          if (this.jumpTimer <= 0 && !this.isJumping) {
            this.isJumping = true;
            this.jumpProgress = 0;
            this.jumpTimer = this.randomInterval(3000, 7000);
          }

          // Update jump state
          if (this.isJumping) {
            this.jumpProgress += deltaTime * 1.67;
            if (this.jumpProgress >= 1) {
              this.isJumping = false;
              this.jumpProgress = 0;
            }
          }

          // Update position
          this.position.x += this.velocity.x * deltaTime;

          // Boundary check
          const charWidth = (window.innerHeight * 0.1) / 3;
          if (this.position.x < 0) {
            this.position.x = 0;
            this.velocity.x = Math.abs(this.velocity.x);
            this.direction = "right";
          } else if (this.position.x > window.innerWidth - charWidth) {
            this.position.x = window.innerWidth - charWidth;
            this.velocity.x = -Math.abs(this.velocity.x);
            this.direction = "left";
          }
        }

        getJumpOffset() {
          if (!this.isJumping) return 0;

          // Parabolic arc: -4(x - 0.5)Â² + 1
          const progress = this.jumpProgress;
          const height = -4 * Math.pow(progress - 0.5, 2) + 1;
          const maxHeight = window.innerHeight * 0.08;

          return height * maxHeight;
        }

        render() {
          if (!this.element) return;

          // Calculate jump offset
          const jumpOffset = this.getJumpOffset();

          // Apply position transform
          let transform = `translate3d(${
            this.position.x
          }px, ${-jumpOffset}px, 0)`;

          // Flip character based on direction
          if (this.direction === "left") {
            transform += " scaleX(-1)";
          }

          this.element.style.transform = transform;

          // Counter-flip the name label to keep text readable
          const nameLabel = this.element.querySelector(".name-label");
          if (nameLabel) {
            if (this.direction === "left") {
              nameLabel.style.transform = "translateX(-50%) scaleX(-1)";
            } else {
              nameLabel.style.transform = "translateX(-50%)";
            }
          }

          // Update walking class
          if (Math.abs(this.velocity.x) > 1) {
            this.element.classList.add("walking");
          } else {
            this.element.classList.remove("walking");
          }
        }

        destroy() {
          if (this.element && this.element.parentNode) {
            this.element.parentNode.removeChild(this.element);
          }
        }
      }

      // ===== CHARACTER MANAGER =====
      class CharacterManager {
        constructor() {
          this.characters = [];
          this.maxCharacters = 15;
          this.nextId = 1;
          this.container = document.getElementById("characters-container");
          this.storageKey = "minecraft-characters";
        }

        canSpawn() {
          return this.characters.length < this.maxCharacters;
        }

        spawn(name, colors) {
          if (!this.canSpawn()) {
            return null;
          }

          const character = new MinecraftCharacter(name, colors, this.nextId++);
          character.spawn(this.container);
          this.characters.push(character);
          this.updateCounter();
          this.saveCharacters();

          return character;
        }

        update(deltaTime) {
          this.characters.forEach((char) => char.update(deltaTime));
        }

        render() {
          this.characters.forEach((char) => char.render());
        }

        updateCounter() {
          const counter = document.getElementById("char-count");
          if (counter) {
            counter.textContent = this.characters.length;
          }

          // Update button state
          const button = document.querySelector("#spawn-form button");
          if (button) {
            button.disabled = !this.canSpawn();
            button.textContent = this.canSpawn()
              ? "Add Character"
              : "Max Characters";
          }
        }

        saveCharacters() {
          try {
            const characterData = this.characters.map((char) => ({
              id: char.id,
              name: char.name,
              colors: char.colors,
            }));
            localStorage.setItem(
              this.storageKey,
              JSON.stringify(characterData)
            );
          } catch (error) {
            console.warn("Failed to save characters to localStorage:", error);
          }
        }

        loadCharacters() {
          try {
            const storedData = localStorage.getItem(this.storageKey);
            if (!storedData) return;

            const characterData = JSON.parse(storedData);
            if (!Array.isArray(characterData)) return;

            // Spawn each saved character
            characterData.forEach((data) => {
              if (data.id && data.name && data.colors) {
                const character = new MinecraftCharacter(
                  data.name,
                  data.colors,
                  data.id
                );
                character.spawn(this.container);
                this.characters.push(character);
              }
            });

            // Update nextId to avoid conflicts
            if (this.characters.length > 0) {
              this.nextId =
                Math.max(...this.characters.map((char) => char.id)) + 1;
            }

            this.updateCounter();
          } catch (error) {
            console.warn("Failed to load characters from localStorage:", error);
          }
        }
      }

      // ===== GAME LOOP =====
      class GameLoop {
        constructor(manager) {
          this.manager = manager;
          this.lastTime = 0;
          this.running = false;
        }

        start() {
          this.running = true;
          this.lastTime = performance.now();
          this.loop();
        }

        loop = () => {
          if (!this.running) return;

          const currentTime = performance.now();
          const deltaTime = (currentTime - this.lastTime) / 1000;
          this.lastTime = currentTime;

          // Update all characters
          this.manager.update(deltaTime);

          // Render all characters
          this.manager.render();

          // Request next frame
          requestAnimationFrame(this.loop);
        };

        stop() {
          this.running = false;
        }
      }

      // ===== INITIALIZATION =====
      document.addEventListener("DOMContentLoaded", () => {
        const manager = new CharacterManager();
        const gameLoop = new GameLoop(manager);

        // Load saved characters from localStorage
        manager.loadCharacters();

        // Form submission handler
        const form = document.getElementById("spawn-form");
        form.addEventListener("submit", (e) => {
          e.preventDefault();

          if (!manager.canSpawn()) {
            alert("Maximum characters reached (15)!");
            return;
          }

          const name = document.getElementById("char-name").value.trim();
          const colors = {
            skin: document.getElementById("skin-color").value,
            shirt: document.getElementById("shirt-color").value,
            pants: document.getElementById("pants-color").value,
          };

          manager.spawn(name, colors);

          // Reset name field only
          document.getElementById("char-name").value = "";
          document.getElementById("char-name").focus();
        });

        // Start game loop
        gameLoop.start();

        // Handle window resize
        window.addEventListener("resize", () => {
          manager.render();
        });
      });
    </script>
  </body>
</html>
